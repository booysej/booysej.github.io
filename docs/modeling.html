<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Jacques Booysen - Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Jacques Booysen</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cert.html">
 <span class="menu-text">Certifications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./modeling.html" aria-current="page">
 <span class="menu-text">Modeling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./papers.html">
 <span class="menu-text">Papers</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#renewable-energy-forecasting" id="toc-renewable-energy-forecasting" class="nav-link active" data-scroll-target="#renewable-energy-forecasting">Renewable Energy Forecasting</a>
  <ul class="collapse">
  <li><a href="#climate-change-energy-model" id="toc-climate-change-energy-model" class="nav-link" data-scroll-target="#climate-change-energy-model">Climate Change Energy Model</a></li>
  </ul></li>
  <li><a href="#eskom-geo-based-load-forecasting" id="toc-eskom-geo-based-load-forecasting" class="nav-link" data-scroll-target="#eskom-geo-based-load-forecasting">Eskom Geo Based Load Forecasting</a></li>
  <li><a href="#inter-connector-feasibility-study-anna" id="toc-inter-connector-feasibility-study-anna" class="nav-link" data-scroll-target="#inter-connector-feasibility-study-anna">Inter connector Feasibility Study ANNA</a>
  <ul class="collapse">
  <li><a href="#energy-modelling-of-anna-400kv-interconnector-between-angola-and-namibia-interconnector-impact-study" id="toc-energy-modelling-of-anna-400kv-interconnector-between-angola-and-namibia-interconnector-impact-study" class="nav-link" data-scroll-target="#energy-modelling-of-anna-400kv-interconnector-between-angola-and-namibia-interconnector-impact-study">Energy modelling of ANNA 400kV interconnector between Angola and Namibia (Interconnector Impact Study)</a></li>
  </ul></li>
  <li><a href="#market-analysis-sappeapp" id="toc-market-analysis-sappeapp" class="nav-link" data-scroll-target="#market-analysis-sappeapp">Market Analysis SAPP/EAPP</a>
  <ul class="collapse">
  <li><a href="#sapp-eapp---energy-modelling" id="toc-sapp-eapp---energy-modelling" class="nav-link" data-scroll-target="#sapp-eapp---energy-modelling">SAPP EAPP - Energy Modelling</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><img src="images/paste-912FFF92.png" class="img-fluid"></a></li>
  <li><a href="#least-cost-energy-modelling-misc" id="toc-least-cost-energy-modelling-misc" class="nav-link" data-scroll-target="#least-cost-energy-modelling-misc">Least cost energy modelling (misc)</a></li>
  <li><a href="#sapp-pool-price-forecasting" id="toc-sapp-pool-price-forecasting" class="nav-link" data-scroll-target="#sapp-pool-price-forecasting">SAPP Pool Price Forecasting</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Find below an overview of only some of the research and modelling projects i have been involved in and gained experience as a data scientist.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Including Demand and Supply Side forecasting, dynamic baselines for embedded solar customers, short and long term optimization etc.</p>
<section id="renewable-energy-forecasting" class="level2">
<h2 class="anchored" data-anchor-id="renewable-energy-forecasting">Renewable Energy Forecasting</h2>
<section id="solar-pv" class="level4">
<h4 class="anchored" data-anchor-id="solar-pv">Solar PV</h4>
<ul>
<li><p>Developed week ahead hourly forecast of Solar PV plants based on global circulation models (<a href="https://en.wikipedia.org/wiki/Global_Forecast_System">GFS</a>), historic satellite data (<a href="https://atmosphere.copernicus.eu/sites/default/files/2022-01/CAMS2_73_2021SC1_D3.2.1_2021_UserGuide_v1.pdf">CAMS</a>/<a href="https://www.eumetsat.int/">EUMETSAT</a>), historic power output data.</p></li>
<li><p>R Shiny App interface for all Solar/Wind IPP plants using renewable models.</p>
<p><img src="images/south-africa-windpv-powe.png" class="img-fluid" width="704"></p>
<p><img src="images/paste-D4C0BCA0.png" class="img-fluid"></p>
<p><img src="images/paste-FF7151EF.png" class="img-fluid"></p></li>
<li><p>Solar Potential exploratory tool developed in DIAS (In house R shiny framework - before R shiny existed)</p>
<p><img src="images/paste-96484924.png" class="img-fluid" width="548"></p>
<p><strong><em>Part1:</em></strong> Regression model mapping the relationship between historic AC power output and cams satellite irradiance (good estimates) after solar tracking transposition, this can be improved if metered (actual) historic solar irradiance data for the plant measured at site are made available. Below is a sample of the uncertainty of our current calibration regression model on average (6.87% hourly). <img src="images/paste-C1353BED.png" class="img-fluid"></p>
<p><strong><em>Part 2</em></strong>: After applying the global circulation hourly weather model (GFS) forecast (hourly weather forecasts have relatively high uncertainty) to model in Part 1, additional uncertainty is introduced, so as to produce the future hourly forecast. For example:</p>
<p>see difference between 1 day ahead and</p>
<p><img src="images/paste-143B4E9B.png" class="img-fluid"></p>
<p>2 day ahead:</p>
<p><img src="images/paste-58738695.png" class="img-fluid"></p>
<p>Using better weather models than GFS would obviously reduce uncertainty</p></li>
</ul>
</section>
<section id="wind" class="level4">
<h4 class="anchored" data-anchor-id="wind">Wind</h4>
<ul>
<li>Developed week ahead hourly power forecast of Wind farms based on global circulation models (GFS), Wind power curves at air density, Wind speed at hub height based on terrain index.</li>
</ul>
<p><img src="images/paste-8CB18B57.png" class="img-fluid"></p>
</section>
<section id="hydro" class="level4">
<h4 class="anchored" data-anchor-id="hydro">Hydro</h4>
<p>Hydro modelling and exploratory analysis of the Zambezi basin system, using both a <a href="https://www.weap21.org/">WEAP</a> (Water evaluation and planning) optimization model and R. Converted an existing monthly WEAP model to an daily model using <a href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5</a> (per hydro sub-basin) rainfall data, and specifically for the Kufue gorge hydro system. Random forest model for lake Kariba using both <a href="https://dahiti.dgfi.tum.de/en/31/time_series/">historic satelite dam level values</a> and daily dam discharge values. Initial research was valuable.</p>
<p><img src="images/paste-2079CD35.png" class="img-fluid"></p>
<p><img src="images/paste-BE1CBFDA.png" class="img-fluid"></p>
</section>
<section id="climate-change-energy-model" class="level3">
<h3 class="anchored" data-anchor-id="climate-change-energy-model">Climate Change Energy Model</h3>
<p>Developed R Shiny App and assisted in modelling Monte Carlo Simulations using power pool least-cost energy MESSAGE model for the climate resilient infrastructure Development Facility (CRIDF) via a long term energy planning and scenario tool and climate change models to determine climatic and economic impacts in the region on the electricity grid in the Southern African power pool over the coming 30 years (2015-2045)</p>
<p><a href="https://www.youtube.com/watch?v=o_Hk2SIlpZo&amp;list=PLU3Eox3pL8bugaewHX4iJjzbF3LHJyjRM&amp;index=5&amp;t=353s">Video</a> of me explaining the SAPP CRIDF model and tool.</p>
</section>
</section>
<section id="eskom-geo-based-load-forecasting" class="level2">
<h2 class="anchored" data-anchor-id="eskom-geo-based-load-forecasting">Eskom Geo Based Load Forecasting</h2>
<section id="domestic-building-density-per-lsm-estimates-south-africa" class="level4">
<h4 class="anchored" data-anchor-id="domestic-building-density-per-lsm-estimates-south-africa">Domestic Building Density per LSM Estimates South Africa</h4>
<p>Linked big and complex spatial data in Oracle Spatial, and developed a spatial filtering algorithm to exclude public spaces.</p>
<p><em>Filter out public space areas with open street map layers. Use spatial buffering algorithm below to further filter out public space. Find Nearest Neighbour (NN) distances distribution of all the buildings in each enumeration area. Finding nearest neighbour for 11,310,724 buildings in 80 000 areas. Buffer width = mean(NN) + 1.96 stddev (95th)</em></p>
<p><em>Draw Buffers around each building (red) merging into each other. Filter out buildings with nearest neighbour distances &gt; mean(NN) + 2 stddev. New area size (red) is more robust and proved to exclude public space undetected before.</em>&nbsp;</p>
<p><img src="images/paste-480C815D.png" class="img-fluid" width="484"></p>
<p><strong>Example where algorithm excludes a public park in an enumeration area</strong></p>
<p>Overlayed with Google street view and Spatial LSM intelligence:</p>
<p><img src="images/paste-E22E7BC0.png" class="img-fluid" width="489"></p>
</section>
</section>
<section id="inter-connector-feasibility-study-anna" class="level2">
<h2 class="anchored" data-anchor-id="inter-connector-feasibility-study-anna">Inter connector Feasibility Study ANNA</h2>
<section id="energy-modelling-of-anna-400kv-interconnector-between-angola-and-namibia-interconnector-impact-study" class="level3">
<h3 class="anchored" data-anchor-id="energy-modelling-of-anna-400kv-interconnector-between-angola-and-namibia-interconnector-impact-study">Energy modelling of ANNA 400kV interconnector between Angola and Namibia (Interconnector Impact Study)</h3>
<p>Utilisation of a least-cost energy flow Electricity Market Model in MESSAGE, to estimate the energy flows and changes in energy flows within and between the interconnected SAPP power pool countries 20 years ahead, given the proposed construction of the ANNA 400kV interconnector between Angola and Namibia, with a transfer capability of 700MW ANNA; with a proposed commissioning and operational year 2025 under a most likely base scenario, and limited variant scenarios. Developed in MESSAGE – based on IRENA model, A dynamic, bottom-up, multi-year energy system model applying linear &amp; mixed-integer optimization techniques.</p>
<p><img src="images/paste-1630296B.png" class="img-fluid"></p>
<p>Base case (ANNA IN - build)</p>
<p><img src="images/paste-7FDFAC07.png" class="img-fluid"></p>
<p>Hydro-logical Shock (ANNA IN - build)</p>
<p><img src="images/paste-84CA1974.png" class="img-fluid"></p>
<p>ANNA OUT (not build)</p>
</section>
</section>
<section id="market-analysis-sappeapp" class="level2">
<h2 class="anchored" data-anchor-id="market-analysis-sappeapp">Market Analysis SAPP/EAPP</h2>
<section id="sapp-eapp---energy-modelling" class="level3">
<h3 class="anchored" data-anchor-id="sapp-eapp---energy-modelling">SAPP EAPP - Energy Modelling</h3>
<p>Assistant modeler and dashboard developer. The Optimization model estimates least-cost energy flows 20 years ahead within &amp; between interconnected SAPP-EAPP (Southern/Eastern African Power Pool) countries and power pools, Developed in MESSAGE – based on IRENA model, A dynamic, bottom-up, multi-year energy system model applying linear &amp; mixed-integer optimization techniques. Results are shown over a medium to long term till 2040 and for different scenarios.Each country modelled as a node interconnected by cross-border Tx Lines.</p>
</section>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"><img src="images/paste-912FFF92.png" class="img-fluid"></h2>
</section>
<section id="least-cost-energy-modelling-misc" class="level2">
<h2 class="anchored" data-anchor-id="least-cost-energy-modelling-misc">Least cost energy modelling (misc)</h2>
<p><img src="images/paste-8468D417.png" class="img-fluid"></p>
</section>
<section id="sapp-pool-price-forecasting" class="level2">
<h2 class="anchored" data-anchor-id="sapp-pool-price-forecasting">SAPP Pool Price Forecasting</h2>
<p><img src="images/paste-37D8A8EA.png" class="img-fluid"></p>
<p>Can forecast the price trend, but better data needed for price spikes.</p>
<p>MAE: 22 USD/MWh</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This page was created by me with Quarto <a href="https://quarto.org/" class="uri">https://quarto.org/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>